        Map<GenerationElement, FactoryComponent> fcs = (Map<GenerationElement, FactoryComponent>) ctx.getValue(FcoreBuilderConstants.CURRENT_FCORE);

        FactoryComponent fc = fcs.get((GenerationElement) (parameter.eContainer()));

        ProductionPlan pp = (ProductionPlan) fc.getOrchestration();
        DomainViewpoint dvp = (DomainViewpoint) fc.getViewpointContainer().getViewpoint(DomainViewpoint.class);

        DomainURI genModelDomainURI = null;
        URI uri = ((HashMap<EmfGeneration, URI>) ctx.getValue(FcoreBuilderConstants.GENMODEL_URIS)).get(parameter);
        for (Domain domain : dvp.getDomains()) {
            if (domain instanceof DomainURI) {
                DomainURI domainUri = (DomainURI) domain;
                if (uri.equals(domainUri.getUri())) {
                    genModelDomainURI = domainUri;
                    break;
                }
            }
        }
        if (genModelDomainURI == null) {
            genModelDomainURI = DomainFactory.eINSTANCE.createDomainURI();
            genModelDomainURI.setUri(uri);
            dvp.getDomains().add(genModelDomainURI);
        }

        Map<String, Type> contracts = new HashMap<String, Type>();
        Map<String, OrchestrationParameter> parameters = new HashMap<String, OrchestrationParameter>();

        for (OrchestrationParameter param : pp.getOrchestrationParameters()) {
            if (ActivityInvocationHelper.GENERATION_EXTENSION_PARAMETER_NAME.equals(param.getName())) {
                parameters.put("pattern.substitutions", param);
            }
        }

        ResourceSet resourceSet = fc.eResource().getResourceSet();
        if (parameter.isGenerateModel()) {
            TypeDomainURI typeDomainURI = DomainFactory.eINSTANCE.createTypeDomainURI();
            typeDomainURI.setDomain(genModelDomainURI);
            contracts.put("genModelURI", typeDomainURI);
            ActivityInvocationHelper.addInvocation(pp, (Activity) resourceSet.getEObject(URI.createURI(this.modelActivity, false), true), contracts, parameters);
        }
        if (parameter.isGenerateEdit()) {
            TypeDomainURI typeDomainURI = DomainFactory.eINSTANCE.createTypeDomainURI();
            typeDomainURI.setDomain(genModelDomainURI);
            contracts.put("genModelURI", typeDomainURI);
            ActivityInvocationHelper.addInvocation(pp, (Activity) resourceSet.getEObject(URI.createURI(this.editActivity, false), true), contracts, parameters);
        }
        if (parameter.isGenerateEditor()) {
            TypeDomainURI typeDomainURI = DomainFactory.eINSTANCE.createTypeDomainURI();
            typeDomainURI.setDomain(genModelDomainURI);
            contracts.put("genModelURI", typeDomainURI);
            ActivityInvocationHelper.addInvocation(pp, (Activity) resourceSet.getEObject(URI.createURI(this.editorActivity, false), true), contracts, parameters);
        }
