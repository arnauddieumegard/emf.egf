	<target name="<%=new GenerationHelper().getPositionString(aggregateStep)%>" depends="init,install.egf" >
		<anteclipse target="<%=new GenerationHelper().getPositionString(aggregateStep)%>_dropins" />
		<anteclipse target="<%=new GenerationHelper().getPositionString(aggregateStep)%>_sitep2" />
	</target>	

	<target name="<%=new GenerationHelper().getPositionString(aggregateStep)%>_dropins">
<%for (PublishStep publishStep : aggregateStep.getPublishSteps()) {
if (publishStep.getJob().isEnabled()) {
String location = "${build.root}/../../" + new GenerationHelper().getJobName(ctx, publishStep.getJob()) + "/workspace/result/publish/" + publishStep.getComponent().getName() + "/dropins";
String propertyName = "aggregateDropinsFrom_" + publishStep.getComponent().getName();
String propertyName2 = "aggregateVersionFrom_" + publishStep.getComponent().getName();%>
		<pathconvert property="<%=propertyName%>">
			<first count="1">
				<dirset dir="<%=location%>" includes="**/eclipse/" />
			</first>
		</pathconvert>
		<copy todir="${publish}/<%=aggregateStep.getName()%>/dropins/<%=aggregateStep.getName()%>/eclipse/" >
			<fileset dir="${<%=propertyName%>}"/>
		</copy>
		<pathconvert property="<%=propertyName2%>">
			<first count="1">
				<fileset dir="<%=location%>" includes="**/*_version_*" />
			</first>
		</pathconvert>
		<copy todir="${publish}/<%=aggregateStep.getName()%>/dropins/<%=aggregateStep.getName()%>/" >
			<fileset file="${<%=propertyName2%>}"/>
		</copy>
<%}}%>
	</target>	

	<target name="<%=new GenerationHelper().getPositionString(aggregateStep)%>_sitep2">
		<!-- see http://wiki.eclipse.org/Equinox/p2/Ant_Tasks -->
		<p2.mirror>
			<repository location="file:/${publish}/<%=aggregateStep.getName()%>/site.p2" name="repository aggregation" />
			<source>
<%for (PublishStep publishStep : aggregateStep.getPublishSteps()) {
if (publishStep.getJob().isEnabled()) {
if (publishStep.getComponent() instanceof Feature) {
String location = "file:/${build.root}/../../" + new GenerationHelper().getJobName(ctx, publishStep.getJob()) + "/workspace/result/publish/" + publishStep.getComponent().getName() + "/site.p2";%>
				<repository location="<%=location%>" />
<%}}}%>
<%for (String updateSiteUrl : aggregateStep.getUpdateSiteUrls()) {%>
				<repository location="<%=updateSiteUrl%>" />
<%}%>
			</source>
		</p2.mirror>
	</target>
