<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>
		EGF Tutorial - Pattern. First steps.
	</title>
	<link rel="stylesheet" href="../book.css" charset="ISO-8859-1" type="text/css" />

	<meta name="copyright" content="Copyright (c) Thales Corporate Services S.A.S, 2009. This page is made available under license. For full details see the LEGAL in the documentation book that contains this page." />
	<meta name="author" content="Benoit Langlois" />
	<meta name="keywords" content="egf,pattern"/>
</head>

<body xml:lang="EN-US" lang="EN-US">

<table border="0" cellpadding="2" cellspacing="0" width="100%">
  <tbody>
    <tr>
    	<td colspan="2" align="left" bgcolor="#0080c0" valign="top">
    	  <h2><font face="Arial,Helvetica"><font color="#ffffff">
    	  &nbsp;EGF Tutorial - Pattern. First steps.
    	  </font></font></h2>
    	</td>
    </tr>
	</tbody>
</table>

<p class="Para">This first tutorial explains how to create and execute simple patterns with EGF. A pattern is a solution to a recurrent generation problem. A pattern is based on a language, for instance Jet for model-to-text transformation. The pattern technique allows pattern inheritance, delegation to other patterns in order to elaborate more reusable and customizable generation solutions.</p>

<br/>

<h2 class="Head">1. Creation of pattern</h2>

<h3 class="Head">1.1. Comprehension</h3>
<p class="Para"><i>Pattern organization</i>. Patterns are organized by pattern libraries. A <b>pattern library</b> contains a set of patterns and a set of pattern libraries.</p>
<p class="Para"><i>Pattern nature</i>. A <b>pattern nature</b> indicates to which language the pattern implementation must conform (e.g. Java, Jet).</p>
<p class="Para"><i>Pattern views</i>. A pattern is visualized with three different folders: 1) Overview, 2) Specification which represents the external view of a pattern, 3) Implementation which represents the internal view of a pattern and where the pattern is implemented.</p>


<h3 class="Head">1.2. Practice</h3>

<p class="Para">The sequence of actions to <i>create a pattern</i>:</p>
<ul CLASS="UnorderedList">
    <li CLASS="Item">Create the <i>viewpoints</i> node - On a factory component, Commands: <i>[New Child][Viewpoints]</i></li>
    <li CLASS="Item">Create the <i>Pattern Viewpoint</i> node - On the viewpoints node, Commands: <i>[New Child][Pattern Viewpoint]</i></li>
    <li CLASS="Item">Create a pattern library - On the pattern viewpoint, Commands: <i>[New Child][Library]</i></li>
    <li CLASS="Item">Next, create a <i>pattern</i> - On the pattern library, Commands: <i>[New Child][JetNature Pattern | JavaNature Pattern]</i></li>
    <li CLASS="Item">Save the model</li>
    <li CLASS="Item">Edit the pattern -  On the pattern, Commands: <i>[Right-Click][Edit]</i></li>
    <li CLASS="Item">Set the pattern name</li>
</ul>

<h3 class="Head">1.3. Application</h3>
<p class="Para">Create a pattern with the Jet nature.</p>

<p align="left">
  <img src="./images/egf_uc1_pattern_1.png" alt="New pattern"/>
</p>

<br/>

<h2 class="Head">2. Definition of the pattern specification</h2>

<h3 class="Head">2.1. Comprehension</h3>

<p class="Para"><i>Specification view</i>. This view enables to set the super-pattern of the current pattern when pattern inheritance is needed, the pattern nature already set during the pattern creation, the pattern parameters.</p>
<p class="Para"><i>Pattern query and parameter</i>. The pattern applies queries over the resource that the pattern consumes, for instance a model. Each query record is successively stored in a parameter. The record process is described in the pattern implementation.</p>
<p class="Para"><i>Pattern query</i>. EGF proposes a default model query. The query list is extensible.</p>
<p class="Para"><i>Pattern parameter</i>. The pattern type is either a class defined in an ecore model or a Java type (class or interface).</p>


<h3 class="Head">2.2. Practice</h3>
<p class="Para">The sequence of actions to <i>pattern parameters and their query</i>:</p>
<ul CLASS="UnorderedList">
    <li CLASS="Item">In the Specification view, in the Parameters section - Command: <i>[+]</i>, set the parameter name</li>
    <li CLASS="Item">Set the parameter type - Command: choose the model and a class type</li>
    <li CLASS="Item">Set the query - Command: choose the query, for instance <i>Basic query</i></li>
    <li CLASS="Item">Set the contract name, mode, and mandatory values</li>
</ul>

<h3 class="Head">2.3. Application</h3>
<p class="Para">Create an EClass parameter with the <i>Basic query</i> to navigate over the model.</p>

<p align="left">
  <img src="./images/egf_uc1_pattern_2.png" alt="Pattern specification"/>
</p>


<h2 class="Head">3. Definition of the pattern implementation</h2>

<h3 class="Head">3.1. Comprehension</h3>

<p class="Para"><i>Implementation view</i>. This view enables to define define pattern methods, the method orchestration, and local variables.</p>
<p class="Para"><i>Pattern methods</i>. Three methods are predefined: header, init, and footer. Header is used for instance to declare the Jet declaration, init for the initialization of local variables. The user methods contain a description that conforms to the pattern nature, for instance Jet code.</p>
<p class="Para"><i>Pattern method orchestration</i>. The method orchestration defines the order to call available methods and patterns: methods local to the current pattern, methods from the super-patterns, pattern call without parameter, pattern call with parameter context injection.</p>
<p class="Para"><i>Pattern variables</i>. The pattern variables are accessible by any method of the current pattern. The type is either a class defined in an ecore model or a Java type (class or interface).</p>


<h3 class="Head">3.2. Practice</h3>
<p class="Para">The sequence of actions to access to a method implementation: double-click on a method of the method list. Next, a pattern templates editor allows to edit any other method.</p>
<ul CLASS="UnorderedList">
    <li CLASS="Item">In the Specification view, in the Parameters section - Command: <i>[+]</i>, set the parameter name</li>
    <li CLASS="Item">Set the parameter type - Command: choose the model and a class type</li>
    <li CLASS="Item">Set the query - Command: choose the query, for instance <i>Basic query</i></li>
    <li CLASS="Item">Set the contract name, mode, and mandatory values</li>
</ul>


<h3 class="Head">3.3. Application</h3>
<p class="Para">Implement the default body method. Add the following Jet code:</p>
				<font color="777777"><pre>
Hello &lt;%= aClass.getName() %&gt;!
				</pre></font>


<br/>

<h2 class="Head">4. Configuration of the pattern execution</h2>

<h3 class="Head">4.1. Comprehension - Definition of the reporter</h3>
<p class="Para"><i>Reporter</i>. A reporter serves to report the result of the pattern implementation, for instance on the console or in a file. A reporter implements the PatternExecutionReporter class.</p>
<p class="Para"><i>Report process</i>. There are two methods to report a queries: 1) for each query instance with the <i>loopFinished</i> method, 2) when the query is completely process with the <i>executionFinished</i> method.</p>


<h3 class="Head">4.2. Practice</h3>

<p class="Para">Create a reporter Java class like this one:</p>
				<font color="777777"><pre>
Package org.eclipse.egf.examples.uc1.reporter;

import java.util.Map;

import org.eclipse.egf.model.pattern.PatternContext;
import org.eclipse.egf.model.pattern.PatternExecutionReporter;

public class MyReporter implements PatternExecutionReporter{

	@Override
	public void executionFinished(String output, PatternContext context) {
		System.out.println("Result of pattern:\n"+output);
		
	}

	@Override
	public void loopFinished(String output, PatternContext context,
			Map &lt; String, Object &gt; parameterValues) {
		// TODO Auto-generated method stub
		
	}

}
				</pre></font>

<h3 class="Head">4.3. Comprehension - Configuration of the execution</h3>
<p class="Para"><i>Pattern strategies</i>. A pattern strategy indicates how to apply patterns onto a resource. For instance, a pattern-oriented strategy successively applies a set of patterns onto a resource; a model-oriented strategy applies a set of patterns successively onto each model element.</p>
<p class="Para"><i>Reporter task</i>. A task applies a strategy with a set of arguments: 1) the resource (e.g., a model URI), 2) the pattern(s) or the pattern library(ies), 3) the reporter. Those arguments are provided by a task invocation in a factory component.</p>


<h3 class="Head">4.4. Practice</h3>
<p class="Para">The sequence of actions to create a task:</p>
<ul CLASS="UnorderedList">
    <li CLASS="Item">Create a task</li>
    <li CLASS="Item">On the Task, on the Task Production section, select a strategy, for instance <i>PatternTask</i> for one pattern, or <i>DefaultStrategyTask</i> for a pattern-oriented strategy</li>
    <li CLASS="Item">Create Task Contracts:</li>
    <ul CLASS="UnorderedList">
        <li CLASS="Item">For PatternTask: pattern.id (String), pattern.execution.reporter (PatternExecutionReporter type) with reference of the reporter, domain (URI)</li>
        <li CLASS="Item">For DefaultStrategyTask: patternIds (String), <b>pattern.execution.reporter (PatternExecutionReporter type) with reference of the reporter </b>, domain (URI)</li>
    </ul>
</ul>

<p class="Para">The sequence of actions to configure the task invocation:</p>
<ul CLASS="UnorderedList">
    <li CLASS="Item">Create a task invocation in production plan</li>
    <li CLASS="Item">Associate the task invocation to the new task for pattern execution or an existing task </li>
    <li CLASS="Item">Provide a value to every expected contract</li>
</ul>

<h3 class="Head">4.5. Application</h3>
<p class="Para">Create a task that uses PatternTask which uses the reporter previously created.</p>

<p align="left">
  <img src="./images/egf_uc1_pattern_3.png" alt="Pattern task"/>
</p>

<p class="Para">Create a task invocation for the new task.</p>

<p align="left">
  <img src="./images/egf_uc1_pattern_4.png" alt="Pattern task invocation"/>
</p>

<p class="Para">Finally, execute the factory component.</p>

</body>
</html>
